function loadAllBookingData(){$(".overlay").removeClass("overlayHide"),$(".loadingContainer").css({left:"45%"}),switchAccordian("bookingCustomerAccordianButton"),switchAccordian("bookingPetAccordianButton"),switchAccordian("bookingCostAccordianButton"),bookingid=$("#editBookingId").val(),$.ajax({method:"POST",url:"loadEditCosts.php",data:{bookingid:bookingid}}).done(function(e){"Fail"!=e?(e=e.split("*"),typeOfBooking=e[0],loadBookingData(typeOfBooking),paymentType=e[1],deposit=e[2],bookingDate=e[3],paymentNote=e[4]):alert("There was a problem loading the booking details.")}),$.ajax({method:"POST",url:"loadEditAdditional.php"}).done(function(e){if("Fail"!=e){if(e=e.split("*"),"null"!=e[0]){e[0]=e[0].replace(/\"/g,""),e[0]=e[0].replace(/[\[\]']+/g,""),masterIdList=e[0].split(","),e[1]=e[1].replace(/\"/g,""),e[1]=e[1].replace(/[\[\]']+/g,""),additionalDesc=e[1].split(","),e[2]=e[2].replace(/\"/g,""),e[2]=e[2].replace(/[\[\]']+/g,""),additionalQuantity=e[2].split(","),e[3]=e[3].replace(/\"/g,""),e[3]=e[3].replace(/[\[\]']+/g,""),additionalPrices=e[3].split(","),e[4]=e[4].replace(/\"/g,""),e[4]=e[4].replace(/[\[\]']+/g,""),additionalType=e[4].split(",");for(var t=0;t<=masterIdList.length-1;t++){loadOtherCharge();var o=$("#otherChargeCount").val();$(".extraCharge").each(function(){$(this).removeClass("newCharge"),$(this).addClass("updateCharge")}),$("#extraCharge"+o+" .formInput .extraChargeDesc").val(additionalDesc[t]),$("#extraCharge"+o+" .formInput .extraChargeQuantity").val(additionalQuantity[t]),$("#extraCharge"+o+" .formInput .extraChargePrice").val(additionalPrices[t]),$("#extraCharge"+o+" .formInput .extraChargeType").val(additionalType[t])}for(var a=$("#otherChargeCount").val(),t=1;a>=t;t++)updateExtraChargePrice("extraCharge"+t)}}else alert("There was a problem loading the additional charges/discounts.")})}function loadBookingData(e,t){$.ajax({method:"POST",url:"loadEditBooking.php",data:{bookingtype:e}}).done(function(t){if("Fail"!=t)if("Over Night"==e)t=t.split("*"),clientId=t[2],liveSearchLoadClient(clientId,function(){insertclientdataovernight()}),liveSearchLoadDogs(clientId,function(){insertdogsdataovernight()}),kennelsBooked=t[4],kennelsBooked=kennelsBooked.replace(/\"/g,""),kennelsBooked=kennelsBooked.replace(/[\[\]']+/g,""),kennelsBooked=kennelsBooked.split(","),bookedDogsIds=t[3],bookedDogsIds=bookedDogsIds.replace(/\"/g,""),bookedDogsIds=bookedDogsIds.replace(/[\[\]']+/g,""),bookedDogsIds=bookedDogsIds.split(","),"split"==t[5]?(splitBooking=!0,checkInDates=t[0],checkOutDates=t[1],checkInDates=checkInDates.replace(/\"/g,""),checkInDates=checkInDates.replace(/[\[\]']+/g,""),checkInDates=checkInDates.split(","),checkOutDates=checkOutDates.replace(/\"/g,""),checkOutDates=checkOutDates.replace(/[\[\]']+/g,""),checkOutDates=checkOutDates.split(","),checkIn=formatDateReverse(checkInDates[0]),checkOut=formatDateReverse(checkOutDates[checkInDates.length-1]),calendarid=t[6]):(checkIn=t[0],checkOut=t[1],checkIn=checkIn.split("-"),checkIn=checkIn[1]+"/"+checkIn[2]+"/"+checkIn[0],checkOut=checkOut.split("-"),checkOut=checkOut[1]+"/"+checkOut[2]+"/"+checkOut[0]);else{t=t.split("."),clientId=t[0];for(var o=1;o<=t.length-1;o++)t[o]=t[o].replace(/\"/g,""),t[o]=t[o].replace(/[\[\]']+/g,"");dayCareDates=t[2],dayCareDates=dayCareDates.split(",");var a=t[2].replace(/\,/g,"");a=a.split("*");for(var o=0;o<=a.length-2;o++){var n=a[o].split("-");n=n[1]+"/"+n[2]+"/"+n[0],-1==bookingDates.indexOf(a[o])&&($("#dayCareDateSelect").val(n),addDayCareDate())}$("#bookingDetailDates").html(bookingDates[0]+" to "+bookingDates[bookingDates.length-1]),bookedDogsIds=t[1],bookedDogsIds=bookedDogsIds.replace(/\"/g,""),bookedDogsIds=bookedDogsIds.replace(/[\[\]']+/g,""),bookedDogsIds=bookedDogsIds.split(","),liveSearchLoadClient(clientId,function(){insertclientdataappointment()}),liveSearchLoadDogs(clientId,function(){insertdogsdataappointment()})}else alert("There was a problem loading the booking details.")})}function insertclientdataappointment(){$("#bookingDetailCustomerName").html(clientName),$("#bookingCustomerSummaryButton").html("<i class='fa fa-users' aria-hidden='true'></i> "+clientName)}function insertdogsdataappointment(){for(var e=0;e<=bookedDogsIds.length-1;e++)for(var t=bookedDogsIds[e].split("."),o=0;o<=t.length-1;o++){t[o]=t[o].replace(" ","");var a=dogsId.indexOf(t[o])+1,n=$("#dogId"+a).val(),i=$("#dogName"+a).html();$("#bookingDetailDogButtons").append("<button onclick='location.href=\"kennelsheet.php?dogid="+n+"\";' class='floatLeft profileButton3'>"+i+"</button>")}$("#bookingDetailDateBooked").html("Date of Booking: "+bookingDate),loadService(),bookingNext(),bookingDogNext(),insertPaymentData(),$(".overlay").addClass("overlayHide"),$(".loadingContainer").css({left:"-9999px"})}function insertclientdataovernight(){$("#bookingDetailCustomerName").html(clientName),$("#bookingCustomerSummaryButton").html("<i class='fa fa-users' aria-hidden='true'></i> "+clientName)}function insertdogsdataovernight(){for(var e=0;e<=bookedDogsIds.length-1;e++)for(var t=bookedDogsIds[e].split("."),o=0;o<=t.length-1;o++){t[o]=t[o].replace(" ","");var a=dogsId.indexOf(t[o])+1,n=$("#dogId"+a).val(),i=$("#dogName"+a).html();$("#bookingDetailDogButtons").append("<button onclick='location.href=\"kennelsheet.php?dogid="+n+"\";' class='floatLeft profileButton3'>"+i+"</button>")}if($("#bookingDetailDateBooked").html("Date of Booking: "+bookingDate),$("#bookingService").val(typeOfBooking),$("#bookingDetailDates").html(checkIn+" to "+checkOut),$("#nightCheckIn").val(checkIn),$("#nightCheckOut").val(checkOut),loadService(),1==splitBooking){bookingDates.push(checkOutDates[checkInDates.length-1]),$("."+calendarid).remove();for(var e=0;e<=kennelsBooked.length-1;e++){var l=kennelsBooked[e],s=bookingDates.indexOf(checkInDates[e]),d=bookingDates.indexOf(checkOutDates[e]);for(o=s;d>=o;o++)$("#K"+l+"-"+bookingDates[o]).removeClass("booked"),splitDateSelected("K"+l+"-"+bookingDates[o])}saveSplitDates()}else loadEditKennels(kennelsBooked);bookingNext(),loadEditAssignKennels(kennelsBooked,bookedDogsIds),bookingDogNext(),insertPaymentData(),$(".overlay").addClass("overlayHide"),$(".loadingContainer").css({left:"-9999px"})}function loadEditKennels(e){for(var t=0;t<=e.length-1;t++)$("#"+e[t]+"KennelRow").addClass("editNow");atWillKennelSelect()}function loadEditAssignKennels(e,t){for(var o=0;o<=t.length-1;o++)for(var a=t[o].split("."),n=0;n<=a.length-1;n++){a[n]=a[n].replace(" ","");var i=dogsId.indexOf(a[n]);1==splitBooking?$("#bookingChoice"+(i+1)).val("Set"):$("#bookingChoice"+(i+1)).val(e[o])}}function insertPaymentData(){$("#deposit").val(deposit),$("#paymentType").val(paymentType),$("#paymentNote").val(paymentNote)}function updateBooking(e){if($(".overlay").removeClass("overlayHide"),$(".loadingContainer").css({left:"45%"}),$("#"+e).html('<i class="fa fa-spinner fa-pulse fa-fw"></i>'),$("#bookingDateSummaryButton").hasClass("selected"))alert("Please select a date.");else if($("#bookingCustomerSummaryButton").hasClass("selected"))alert("Please select a client.");else if($("#bookingPetSummaryButton").hasClass("selected"))alert("Please select your pets.");else if("Over Night"==typeOfBooking)if(1==splitBooking){splitCheckingDates();var t=kennelsSelected;isBooked(splitCheckIn,splitCheckOut,t)}else{var o=formatDate(checkIn),a=formatDate(checkOut),t=kennelsSelected;isBooked(o,a,t)}else updateCosts();$("#"+e).html("Update Booking")}function updateCosts(){var e=subTotal+tax,t=$("#priceRowId").val(),o=$("#paymentType").val(),a=$("#paymentNote").val();$.ajax({method:"POST",url:"updateCosts.php",data:{priceRow:t,subTotal:subTotal,tax:tax,finalTotal:e,deposit:deposit,paymentType:o,typeOfBooking:typeOfBooking,paymentNote:a}}).done(function(e){"Over Night"==typeOfBooking?updateOverNight():updateAppointment()})}function updateOverNight(){for(var e,t=formatDate(checkIn),o=formatDate(checkOut),a="",n=new Array,i=new Array,l=0;l<=kennelsSelected.length-1;l++){n[l]=kennelsSelected[l],i[l]="";for(var s=0;s<=numberOfDogs-1;s++){var d=$("#dateSelectDog"+(s+1)+" option:selected").val();n[l]==d&&""==i[l]&&0==splitBooking?i[l]=dogsId[s]:n[l]==d&&0==splitBooking?i[l]=i[l]+", "+dogsId[s]:"Set"==d&&""==i[l]&&1==splitBooking?i[l]=dogsId[s]:"Set"==d&&1==splitBooking&&(i[l]=i[l]+", "+dogsId[s])}}1==splitBooking?(t=splitCheckIn,o=splitCheckOut,a="split"):a="",$.ajax({method:"POST",url:"updateOverNight.php",data:{newCheckIn:t,newCheckOut:o,updateDogs:i,clientId:clientId,updateKennels:n,splitValue:a}}).done(function(t){console.log(t),"Fail"!=t?(e=t,0!=additionalDesc.length?updateAdditional(function(t){2==t&&(location.href="booking.php?bookingid="+e)}):location.href="booking.php?bookingid="+e):alert("Something went wrong updating the booking.")})}function updateAdditional(e){for(var t=new Array,o=0,a=0;a<=deleteIdList.length-1;a++)t.push(masterIdList[deleteIdList[a]]),masterIdList.splice(deleteIdList[a],1);0!=t.length?$.ajax({method:"POST",url:"deleteAdditional.php",data:{deleteChargesIds:t}}).done(function(e){"fail"==e?alert("There was a problem deleting some of the additional charges."):o++}):o++,$.ajax({method:"POST",url:"updateAdditional.php",data:{masterIdList:masterIdList,additionalDesc:additionalDesc,additionalQuantity:additionalQuantity,additionalPrices:additionalPrices,additionalType:additionalType}}).done(function(t){"fail"==t?alert("There was a problem updating the additional costs."):(o++,e(o))})}function updateAppointment(){for(var e,t=0,o=0;o<=numberOfDogs-1;o++){var a=dogsId[o],n=$("#dateSelectDog"+(o+1)).find(".search-choice").map(function(){return $(this).text()}).get();$.ajax({method:"POST",url:"updateAppointment.php",data:{selectedDates:n,clientId:clientId,id:a}}).done(function(o){"Fail"!=o&&(e=o,t++,t==numberOfDogs&&0!=additionalDesc.length?updateAdditional(function(t){2==t&&(location.href="booking.php?bookingid="+e)}):t==numberOfDogs&&(location.href="booking.php?bookingid="+o))})}}function markPaid(){$(".overlay").removeClass("overlayHide"),$(".loadingContainer").css({left:"45%"});var e=subTotal+tax;$.ajax({method:"POST",url:"markPaid.php",data:{thisTotal:e}}).done(function(e){location.href="booking.php?bookingid="+e})}var bookedDogsIds,dayCareDates,checkInDates,checkOutDates,masterIdList=new Array,deleteIdList=new Array,calendarid;
